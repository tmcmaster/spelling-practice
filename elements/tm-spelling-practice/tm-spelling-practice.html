<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../elements.html">

<dom-module id="tm-spelling-practice">
  <template>
    <style>
      :host {
        display: block;
        --paper-tabs-selection-bar-color: blue;
      }
      div.wrapper {
        width:100%;
        height:100%;
      }
      div.container {
        margin-left:auto;
        margin-right:auto;
        max-width:500px;
        min-width:500px;
        //border:solid red 1px;
      }
      paper-card {
        padding:10px;
        width:100%;
        height:125px;
      }
      paper-button {
        float:right;
      }
      paper-progress {
        width:100%;
      }
      h2 {
        text-align:center;
      }
      #wordsInput {
        margin-top:10px;
        height: 50px;
        width:99%;
      }
      .hidden {
        display:none;
      }
    </style>
    <div class="wrapper">
      <div class="container">
        <!--<span>{{done}}</span> of <span>{{size}}</span>-->
        <h2>Spelling Practice</h2>
        <paper-progress value="{{done}}" min="0" max="{{size}}" class="red"></paper-progress>
        <iron-pages selected="{{page}}">
          <div>
            <paper-card id="setupPanel">
              <label for="wordsInput">The words you would like to try and spell</label>
              <iron-autogrow-textarea id="wordsInput" value="{{words}}"></iron-autogrow-textarea>
            </paper-card>
          </div>
          <div>
            <paper-card id="playPanel">
                <paper-input id="answerInput" label="Answer goes here" value="{{word}}"></paper-input>
                <paper-button id="doneButton" on-tap="check" raised>Check</paper-button>
                <paper-button id="skipButton" on-tap="skip" raised>Skip</paper-button>
            </paper-card>
          </div>
        </iron-pages>
        <paper-tabs selected="{{page}}" noink>
          <paper-tab>Setup</paper-tab>
          <paper-tab on-tap="play">Play</paper-tab>
        </paper-tabs>
      </div>
    </div>
    <div class="hidden">
      <tm-word-list id="words"/>
      <tm-voice id="voice"/>
    </div>
  </template>

  <script>
    (function(Polymer) {
      'use strict';
      
      Polymer({
        is: 'tm-spelling-practice',
        properties: {
          page : {
            type:Number,
            value:0
          },
          size : {
            type:Number,
            value: 0
          },
          done : {
            type:Number,
            value:0
          },
          progress : {
            type: Object,
            value : {
              size : 4,
              done : 2
            }
          },
          words: {
            type:String,
            value: 'cat bunny frog dog'
          },
          word: {
            type: String,
            value: ''
          }
        },
        play: function() {
          console.log('START button pressed.');
          this.$.voice.say("Let's get started.");
          this.size = this.$.words.setWords(this.words);
          this.page = 1;
          this.question(this.$.words.getCurrentWord());
          focus(this.$.answerInput);
        },
        check: function() {
          console.log('DONE button pressed.');
          if (this.$.words.checkWord(this.word))
          {
            this.$.voice.say("Well done.");
            this.done = this.$.words.getCorrectWords().length;
            this.word = '';
            focus(this.$.answerInput);
            this.question(this.$.words.getCurrentWord());
            if (this.$.words.isCompleted())
            {
              this.page = 0;
            }
          }
          else
          {
            this.feedback(this.word, this.$.words.getCurrentWord());
          }
        },
        skip : function() {
          console.log('SKIP button pressed.');
          this.$.words.skipWord();
          focus(this.$.answerInput);
          this.question(this.$.words.getCurrentWord());
        },
        question : function(word) {
          this.$.voice.say("Please spell " + word + ", and then press Check.");
        },
        feedback : function(spelling, word) {
          this.$.voice.say("You spelt " + spelling + ".");
          focus(this.$.answerInput);
          this.question(word);
        },
        ready: function() {
          console.log('Spelling Practice ready to go.');
        }
      });

      function focus(element) {
        setTimeout(function() {
          element.focus();
        }, 500);
      }
      
    })(window.Polymer);
  </script>
</dom-module>
